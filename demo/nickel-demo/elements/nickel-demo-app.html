<!DOCTYPE html>
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="../bower_components/paper-material/paper-material.html">

<link rel="import" href="../bower_components/nickel-elements/nickel-storage.html">
<!--Imports go here-->

<dom-module id="nickel-demo-app">

   <template>
      <style is="custom-style">
         :host {
            display: block;
         }

         .filler {
            height: 20px;
            background: #3f51b5;
         }

         paper-material {
            padding: 10px;
            margin: 5px 10px;
         }
      </style>

      <nickel-storage id="storage"></nickel-storage>

      <!--Template goes here-->
      <div class="filler"></div>
      <paper-toolbar>
         <div class="title">Nickel Demo</div>
      </paper-toolbar>

      <paper-button raised on-click="_storeObject">Add Item</paper-button>

      <template is="dom-repeat" items="[[objects]]" as="obj">
         <paper-material elevation="2" on-click="_deleteObject">
            <div>{{obj.label}}</div>
         </paper-material>
      </template>
   </template>

   <script>
      "use strict";
      Polymer({
         is: "nickel-demo-app",
         properties: {
            objects: {
               type: Array
            }
         },
         ready: function() {
            this.debounce('loadData', () => {
               this._loadAllObjects();
            }, 1000);
         },
         _storeObject: function() {
            if (!this.currentId) {
               this.currentId = this.objects.length + 1;
            }
            var data = {
               label: 'Item #' + this.currentId,
               value: this.currentId
            }
            this.currentId++;
            this.$.storage.save("TodoItem", data, ['label', 'value'], () => {
               this._loadAllObjects();
            });
         },
         _loadAllObjects: function() {
            this.$.storage.loadAll("TodoItem", (data) => {
               if(this.objects){
                  delete this.objects;
               }
               this.objects = data;
            });
         },
         _deleteObject: function(e) {
            var item = e.model.obj;
            this.$.storage.delete("TodoItem", item, () => {
               this._loadAllObjects();
            });
         },

         _objectsLoaded: function(e) {
            if (e.detail) {
               this.objects = JSON.parse(e.detail.data);
            }
         }
      });
   </script>

</dom-module>
