<!DOCTYPE html>
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">

<link rel="import" href="../bower_components/nickel-elements/nickel-storage-collection.html">
<!--Imports go here-->

<dom-module id="storage-markup-demo">

   <template>
      <style is="custom-style">
         :host {
            display: block;
         }

         .filler {
            height: 20px;
            background: #3f51b5;
         }

         paper-material {
            padding: 10px;
            margin: 5px 10px;
         }
      </style>

      <nickel-storage-collection id="storage" auto-reload data="{{objects}}" path="TodoItem" indexed-attributes="[[indexedAttributes]]" on-data-updated="_dataUpdated"></nickel-storage-collection>


      <!--Template goes here-->
      <div class="filler"></div>

      <paper-toolbar>
         <div class="title">Storage Markup Demo</div>
      </paper-toolbar>

      <paper-button raised on-click="_storeObject">Add Item</paper-button>

      <template is="dom-repeat" items="[[objects]]" as="obj">
         <paper-material elevation="2" on-click="_deleteObject">
            <div>{{obj.label}}</div>
         </paper-material>
      </template>

      <paper-toast id="toast" text="Data updated!" duration="1000"></paper-toast>
   </template>

   <script>
      "use strict";
      Polymer({
         is: "storage-markup-demo",
         properties: {

            objects: {
               type: Array,
               value:[]
            },

            indexedAttributes: {
               type: Array,
               value: ['label', 'value']
            }

         },
         ready: function() {
            this.debounce('loadData', () => {
               this.$.storage.update();
            }, 1000);
         },

         _storeObject: function() {
            if (!this.currentId) {
               this.currentId = this.objects.length + 1;
            }
            var data = {
               label: 'Item #' + this.currentId,
               value: this.currentId
            }
            this.currentId++;
            // Use the StorageMarkup
            this.$.storage.store(data);

         },
         _deleteObject: function(e) {
            var item = e.model.obj;
            // Use the StorageMarkup
            this.$.storage.remove(item);

         },

         _dataUpdated: function(e) {
            this.$.toast.open();
         }
      });
   </script>

</dom-module>
